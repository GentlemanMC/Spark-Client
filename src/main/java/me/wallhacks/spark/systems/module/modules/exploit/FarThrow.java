package me.wallhacks.spark.systems.module.modules.exploit;

import java.util.Arrays;

import me.wallhacks.spark.event.player.PacketSendEvent;
import me.wallhacks.spark.systems.module.Module;
import me.wallhacks.spark.util.MC;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.network.play.client.CPacketPlayerDigging.Action;
import net.minecraft.network.play.client.CPacketPlayerTryUseItem;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import me.wallhacks.spark.systems.setting.settings.BooleanSetting;
import me.wallhacks.spark.systems.setting.settings.IntSetting;
import me.wallhacks.spark.systems.setting.settings.ModeSetting;

@Module.Registration(name = "FarThrow", description = "Throws things farther.")
public class FarThrow extends Module implements MC {


	IntSetting spoof = new IntSetting("Spoof", this, 70, 0, 500);
	BooleanSetting arrows = new BooleanSetting("Arrows", this, true);
	ModeSetting enderpearls = new ModeSetting("EnderPearls", this, "Off",Arrays.asList("Off","On","OnShift"));
	BooleanSetting potions = new BooleanSetting("Potions", this, true);
	BooleanSetting eggsandsnowballs = new BooleanSetting("Eggs&Snowballs", this, true);

	
	@SubscribeEvent
	public void onPacketOut(PacketSendEvent e) {
		if(e.getPacket() instanceof CPacketPlayerDigging && arrows.getValue() && mc.player.getHeldItemMainhand().getItem() == Items.BOW) {
			CPacketPlayerDigging packet = e.getPacket();
			if(packet.getAction() == Action.RELEASE_USE_ITEM) {
				mc.getConnection().sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
				for(int i = 0; i < spoof.getValue(); i++) {
					mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(posX(), posY() + 1e-10, posZ(), rotationYaw(), rotationPitch(), false));
					mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(posX(), posY(), posZ(), rotationYaw(), rotationPitch(), true));
				}
			}
		}
		if(e.getPacket() instanceof CPacketPlayerTryUseItem) {
			CPacketPlayerTryUseItem packet = e.getPacket();
			Item item = mc.player.getHeldItem(packet.getHand()).getItem();
			boolean flag1 = (enderpearls.isValueName("On") || (enderpearls.isValueName("OnShift") && mc.player.movementInput.sneak)) && item == Items.ENDER_PEARL;
			boolean flag2 = potions.getValue() && Arrays.asList(Items.LINGERING_POTION, Items.SPLASH_POTION, Items.EXPERIENCE_BOTTLE).contains(item);
			boolean flag3 = eggsandsnowballs.getValue() && Arrays.asList(Items.EGG, Items.SNOWBALL).contains(item);
			if(flag1 || flag2 || flag3) {
				mc.getConnection().sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
				for(int i = 0; i < spoof.getValue(); i++) {
					mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(posX(), posY() + 1e-10, posZ(), rotationYaw(), rotationPitch(), false));
					mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(posX(), posY(), posZ(), rotationYaw(), rotationPitch(), true));
				}
			}
		}
	}
}
